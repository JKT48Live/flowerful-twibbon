<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>JKT48 Flowerful Twibbon</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
		<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
		<!-- Standard SEO Meta Tags -->
		<meta name="description" content="Make your JKT48 Flowerful Twibbon now.">
		<meta name="keywords" content="JKT48, Flowerful, Twibbon">
		<meta name="author" content="JKT48 Live">
		<!-- Facebook Meta Tags -->
		<meta property="og:url" content="https://jkt48live.github.io/tictactoe">
		<meta property="og:type" content="website">
		<meta property="og:title" content="JKT48 Flowerful Twibbon">
		<meta property="og:description" content="Make your JKT48 Flowerful Twibbon now.">
		<meta property="og:image" content="https://telegra.ph/file/6a977f02e153f6f214111.png">
		<!-- Twitter Meta Tags -->
		<meta name="twitter:card" content="summary_large_image">
		<meta name="twitter:title" content="JKT48 Flowerful Twibbon">
		<meta name="twitter:description" content="Make your JKT48 Flowerful Twibbon now.">
		<meta name="twitter:image" content="https://telegra.ph/file/6a977f02e153f6f214111.png">
		<meta name="twitter:site" content="@JKT48LiveX">
		<meta name="twitter:creator" content="@JKT48LiveX">
		<link rel="icon" type="image/x-icon" href="https://telegra.ph/file/b6d02b1228c27548bd4cc.png">
		<style>
			#canvasContainer {
				width: 100%;
				max-width: 500px;
				/* Maximum size */
				margin: auto;
				border: 1px solid #ddd;
				position: relative;
				overflow: hidden;
			}
            .custom-file-container {
                width: fit-content; /* Buat lebar menyesuaikan konten */
                margin-left: auto; /* Margin kiri dan kanan auto untuk pemusatan */
                margin-right: auto;
            }

			canvas {
				width: 100%;
				height: auto;
			}

			.joystick-container {
				display: flex;
				flex-direction: column;
				align-items: center;
			}

			.joystick-row {
				display: flex;
				justify-content: center;
				align-items: center;
			}

			.joystick-btn {
				margin: 3px;
				width: 30px;
				height: 30px;
			}

			.joystick-spacer {
				width: 30px;
				height: 30px;
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.controls-container {
				display: flex;
				justify-content: center;
				align-items: center;
			}

			.slider-container {
				margin-right: 30px;
			}

			#saveImage {
				display: block;
				margin: 20px auto;
			}

			.poppins-font {
				font-family: 'Poppins', sans-serif;
			}
            .container {
                padding-bottom: 60px; /* Atur sesuai dengan kebutuhan */
            }
            .checkbox-container {
                border: 2px solid #ddd;
                border-radius: 10px;
                padding: 10px;
                margin-top: 20px;
                width: fit-content; /* Buat kotak menyesuaikan konten */
                display: inline-block;
                margin-left: auto; /* Margin kiri dan kanan auto untuk pemusatan */
                margin-right: auto;
            }
            .form-check {
                margin: 0 10px; /* Kurangi margin horizontal */
            }
			footer {
				padding: 5px 0;
				background-color: #f8f9fa;
				color: #6c757d;
				border-top: 1px solid #e9ecef;
				position: fixed;
				bottom: 0;
				width: 100%;
				text-align: center;
				font-size: 0.9em;
				font-size: 0.8em;
				font-weight: normal;
			}
		</style>
	</head>
	<body class="poppins-font">
		<div class="container mt-5">
			<h2 class="mb-4 text-center">JKT48 Flowerful Twibbon</h2>
			<div class="custom-file-container">
                <div class="custom-file mb-3">
                  <input type="file" class="custom-file-input" id="imageUpload" accept="image/*">
                  <label class="custom-file-label" for="imageUpload">Pilih foto...</label>
                </div>
            </div>              
			<div id="canvasContainer">
				<canvas id="canvas"></canvas>
			</div>
            <div class="d-flex justify-content-center">
                <div class="checkbox-container text-center">
                  <p>Black & White</p>
                  <div class="d-flex justify-content-center">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="photoBnW" disabled>
                        <label class="form-check-label" for="photoBnW">Foto</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="twibbonBnW">
                        <label class="form-check-label" for="twibbonBnW">Twibbon</label>
                    </div>
                  </div>
                </div>
            </div>
			<div class="container mt-5">
				<div class="controls-container">               
					<div class="slider-container">
						<label for="zoomControl">Zoom:</label>
						<input type="range" id="zoomControl" min="0.1" max="2" value="1" step="0.1" disabled>
					</div>
					<div class="joystick-container">
						<div class="joystick-row">
							<div class="joystick-spacer"></div>
							<button id="moveUp" class="btn btn-primary" disabled>↑</button>
							<div class="joystick-spacer"></div>
						</div>
						<div class="joystick-row">
							<button id="moveLeft" class="btn btn-primary" disabled>←</button>
							<div class="joystick-spacer"></div>
							<button id="moveRight" class="btn btn-primary" disabled>→</button>
						</div>
						<div class="joystick-row">
							<div class="joystick-spacer"></div>
							<button id="moveDown" class="btn btn-primary" disabled>↓</button>
							<div class="joystick-spacer"></div>
						</div>
					</div>
				</div>
				<!-- Other content goes here... -->
			</div>
			<div class="text-center">
				<button class="btn btn-primary" id="saveImage" disabled>Download</button>
			</div>
		</div>
		<footer class="text-center mt-4">
			<p>Made with ❤️ by JKT48 Live</p>
		</footer>
		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
		<script>
            let isBlackAndWhite = false;
			let canvas = document.getElementById('canvas');
			let ctx = canvas.getContext('2d');
			let image = new Image();
			let twibbon = new Image();
			let scale = 1;
			let position = {
				x: 0,
				y: 0
			};
			let dragStart, dragged;
			let MOVE_AMOUNT = 10;
			document.getElementById('moveLeft').addEventListener('click', function() {
				position.x -= MOVE_AMOUNT;
				draw();
			});
			document.getElementById('moveRight').addEventListener('click', function() {
				position.x += MOVE_AMOUNT;
				draw();
			});
			document.getElementById('moveUp').addEventListener('click', function() {
				position.y -= MOVE_AMOUNT;
				draw();
			});
			document.getElementById('moveDown').addEventListener('click', function() {
				position.y += MOVE_AMOUNT;
				draw();
			});
			twibbon.src = 'twibbon.png';
			twibbon.onload = function() {
				draw();
			};
			$('#imageUpload').change(function(e) {
                let file = e.target.files[0];
                if (file) {
                    let reader = new FileReader();
                    reader.onload = function(event) {
                    image.src = event.target.result;
                    image.onload = function() {
                        reset();
                        draw();
                        // Aktifkan checkbox dan tombol download setelah foto diupload
                        document.getElementById('photoBnW').disabled = false;
                        document.getElementById('twibbonBnW').disabled = false;
                        document.getElementById('saveImage').disabled = false;

                        document.getElementById('zoomControl').disabled = false;
                        document.getElementById('moveUp').disabled = false;
                        document.getElementById('moveLeft').disabled = false;
                        document.getElementById('moveRight').disabled = false;
                        document.getElementById('moveDown').disabled = false;
                    }
                    };
                    reader.readAsDataURL(file);
                }
            });

			function reset() {
				scale = 1;
				position = {
					x: 0,
					y: 0
				};
			}

			function draw() {
                let iw = image.width;
                let ih = image.height;
                let cw = canvas.width;
                let ch = canvas.height;
                let scaleFactor = Math.min(cw / iw, ch / ih);
                ctx.clearRect(0, 0, cw, ch);
                ctx.save();
                ctx.translate(cw / 2, ch / 2);
                ctx.scale(scaleFactor * scale, scaleFactor * scale);
                ctx.translate(-iw / 2 + position.x / (scaleFactor * scale), -ih / 2 + position.y / (scaleFactor * scale));

                // Jika pilihan foto hitam putih atau semua hitam putih dipilih
                if (document.getElementById('photoBnW').checked) {
                    let tempCanvas = document.createElement('canvas');
                    let tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = iw;
                    tempCanvas.height = ih;
                    tempCtx.drawImage(image, 0, 0);
                    applyBlackAndWhiteFilter(tempCtx, iw, ih);
                    ctx.drawImage(tempCanvas, 0, 0);
                } else {
                    ctx.drawImage(image, 0, 0);
                }
                
                ctx.restore();

                // Jika pilihan twibbon hitam putih atau semua hitam putih dipilih
                if (document.getElementById('twibbonBnW').checked) {
                    let tempCanvas = document.createElement('canvas');
                    let tempCtx = tempCanvas.getContext('2d');
                    tempCanvas.width = cw;
                    tempCanvas.height = ch;
                    tempCtx.drawImage(twibbon, 0, 0, cw, ch);
                    applyBlackAndWhiteFilter(tempCtx, cw, ch);
                    ctx.drawImage(tempCanvas, 0, 0, cw, ch);
                } else {
                    ctx.drawImage(twibbon, 0, 0, cw, ch);
                }
            }

            function applyBlackAndWhiteFilter(ctx, width, height) {
                let imageData = ctx.getImageData(0, 0, width, height);
                let data = imageData.data;

                for (let i = 0; i < data.length; i += 4) {
                    let avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    data[i] = avg; // red
                    data[i + 1] = avg; // green
                    data[i + 2] = avg; // blue
                }

                ctx.putImageData(imageData, 0, 0);
            }
			function resizeCanvas() {
				canvas.width = $('#canvasContainer').width();
				canvas.height = canvas.width;
				draw();
			}
			$('#zoomControl').on('input', function() {
				scale = parseFloat($(this).val());
				draw();
			});
			canvas.addEventListener('mousedown', function(evt) {
				dragStart = {
					x: evt.offsetX - position.x,
					y: evt.offsetY - position.y
				};
				dragged = false;
			}, false);
			canvas.addEventListener('mousemove', function(evt) {
				if (dragStart) {
					position.x = evt.offsetX - dragStart.x;
					position.y = evt.offsetY - dragStart.y;
					draw();
					dragged = true;
				}
			}, false);
			canvas.addEventListener('mouseup', function(evt) {
				dragStart = null;
			}, false);
			document.getElementById('saveImage').addEventListener('click', function() {
                if (image.src) {
                    let hiddenCanvas = document.createElement('canvas');
                    hiddenCanvas.width = 1080;
                    hiddenCanvas.height = 1080;
                    let hiddenCtx = hiddenCanvas.getContext('2d');

                    let scaleFactor = Math.min(hiddenCanvas.width / image.width, hiddenCanvas.height / image.height);
                    hiddenCtx.save();
                    hiddenCtx.translate(hiddenCanvas.width / 2, hiddenCanvas.height / 2);
                    hiddenCtx.scale(scaleFactor * scale, scaleFactor * scale);
                    hiddenCtx.translate(-image.width / 2 + position.x / (scaleFactor * scale), -image.height / 2 + position.y / (scaleFactor * scale));

                    // Terapkan filter hitam putih pada foto jika dipilih
                    if (document.getElementById('photoBnW').checked) {
                        let tempCanvas = document.createElement('canvas');
                        let tempCtx = tempCanvas.getContext('2d');
                        tempCanvas.width = image.width;
                        tempCanvas.height = image.height;
                        tempCtx.drawImage(image, 0, 0);
                        applyBlackAndWhiteFilter(tempCtx, image.width, image.height);
                        hiddenCtx.drawImage(tempCanvas, 0, 0);
                    } else {
                        hiddenCtx.drawImage(image, 0, 0);
                    }

                    hiddenCtx.restore();

                    // Terapkan filter hitam putih pada twibbon jika dipilih
                    if (document.getElementById('twibbonBnW').checked) {
                        let tempCanvas = document.createElement('canvas');
                        let tempCtx = tempCanvas.getContext('2d');
                        tempCanvas.width = hiddenCanvas.width;
                        tempCanvas.height = hiddenCanvas.height;
                        tempCtx.drawImage(twibbon, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
                        applyBlackAndWhiteFilter(tempCtx, hiddenCanvas.width, hiddenCanvas.height);
                        hiddenCtx.drawImage(tempCanvas, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
                    } else {
                        hiddenCtx.drawImage(twibbon, 0, 0, hiddenCanvas.width, hiddenCanvas.height);
                    }

                    // Buat data URL dan unduh
                    let dataURL = hiddenCanvas.toDataURL('image/png');
                    let link = document.createElement('a');
                    link.download = 'JKT48-Flowerful-Twibbon_JKT48Live.png';
                    link.href = dataURL;
                    link.click();
                }
            });
			$(window).resize(resizeCanvas);
			resizeCanvas();
            document.getElementById('photoBnW').addEventListener('change', draw);
            document.getElementById('twibbonBnW').addEventListener('change', draw);
		</script>
	</body>
</html>